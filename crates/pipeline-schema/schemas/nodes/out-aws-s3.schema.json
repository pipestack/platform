{
  "$schema": "http://json-schema.org/draft-07/schema",
  "$id": "./schemas/nodes/out-s3.schema.json",
  "type": "object",
  "required": ["bucket"],
  "properties": {
    "bucket": {
      "type": "string",
      "minLength": 1,
      "description": "S3 bucket name"
    },
    "prefix": {
      "type": "string",
      "description": "Object key prefix"
    },
    "file_format": {
      "enum": ["json", "parquet", "csv", "avro"],
      "default": "json",
      "description": "Output file format"
    },
    "compression": {
      "enum": ["none", "gzip", "bzip2", "snappy"],
      "default": "none",
      "description": "File compression"
    },
    "partition_by": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Fields to partition by"
    },
    "max_file_size": {
      "type": "string",
      "pattern": "^\\d+[KMGT]?B$",
      "default": "100MB",
      "description": "Max file size before rotation"
    },
    "region": {
      "type": "string",
      "description": "AWS region"
    },
    "credentials": {
      "type": "object",
      "properties": {
        "access_key_id": { "type": "string" },
        "secret_access_key": { "type": "string" },
        "session_token": { "type": "string" },
        "profile": { "type": "string" }
      }
    }
  }
}